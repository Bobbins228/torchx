description: A simple configuration example.
arguments:
  - name: --num_trainers
    help: The number of trainers to use.
    default: 10
    type: int
  - name: --trainer_image
    help: The trainer image to use.
    default: pytorch/torchx:latest

---

import torchelastic.tsm.driver as tsm

trainer_image = tsm.Container(image=args.trainer_image)
reader_image = tsm.Container(image=f"pytorch/torchx:latest")


trainer = tsm.ElasticRole(name="trainer", nprocs_per_node=2, nnodes="4:4").runs("train_main.py", "--epochs", "50", MY_ENV_VAR="foobar").on(trainer_image).replicas(args.num_trainers)

ps = tsm.Role(name="parameter_server").runs("ps_main.py").on(trainer_image).replicas(10)

reader = tsm.Role(name="reader").runs("reader/reader_main.py", "--buffer_size", "1024").on(reader_image).replicas(1)

app = tsm.Application(name="my_train_job").of(trainer, ps, reader)

export(app)
